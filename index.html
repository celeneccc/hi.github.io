import React, { useState, useEffect, useRef } from "react";
import { motion } from "framer-motion";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";

export default function LunarNewYearHorse() {
  const [blessings, setBlessings] = useState([]);
  const [showEnvelope, setShowEnvelope] = useState(false);
  const [opened, setOpened] = useState(false);
  const [countdown, setCountdown] = useState("");
  const [musicOn, setMusicOn] = useState(false);
  const audioRef = useRef(null);

  const messages = [
    "Wishing you unstoppable momentum this Year of the Horse!",
    "May success gallop into your life!",
    "Strength, speed, and prosperity in 2026!",
    "Bold beginnings and victorious endings!"
  ];

  // Countdown to next Lunar New Year (approx Feb 17, 2026)
  useEffect(() => {
    const target = new Date("2026-02-17T00:00:00");
    const interval = setInterval(() => {
      const now = new Date();
      const diff = target - now;
      if (diff <= 0) {
        setCountdown("Happy Lunar New Year! ğŸ‰");
        clearInterval(interval);
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / (1000 * 60)) % 60);
      setCountdown(`${days}d ${hours}h ${minutes}m`);
    }, 1000);
    return () => clearInterval(interval);
  }, []);

  const generateBlessing = () => {
    const random = messages[Math.floor(Math.random() * messages.length)];
    setBlessings([...blessings, random]);
  };

  const openEnvelope = () => {
    setOpened(true);
    generateBlessing();
  };

  const toggleMusic = () => {
    if (!audioRef.current) return;
    if (musicOn) {
      audioRef.current.pause();
    } else {
      audioRef.current.play();
    }
    setMusicOn(!musicOn);
  };

  return (
    <div className="min-h-screen bg-red-600 text-yellow-100 flex flex-col items-center justify-center p-6 relative overflow-hidden">
      <audio
        ref={audioRef}
        loop
        src="https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0c6ff1e3c.mp3?filename=chinese-new-year-112194.mp3"
      />

      <motion.h1
        initial={{ opacity: 0, y: -40 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8 }}
        className="text-4xl md:text-6xl font-bold text-center mb-4"
      >
        ğŸ§§ Lunar New Year â€“ Year of the Horse ğŸ
      </motion.h1>

      <p className="mb-4 text-lg">Countdown: {countdown}</p>

      <Button
        onClick={toggleMusic}
        className="mb-6 bg-yellow-400 text-red-700 rounded-2xl"
      >
        {musicOn ? "ğŸ”‡ Stop Music" : "ğŸµ Play Festive Music"}
      </Button>

      {/* Envelope Section */}
      <Card className="bg-red-700 shadow-2xl rounded-2xl w-full max-w-md">
        <CardContent className="p-6 flex flex-col items-center gap-4">
          {!opened ? (
            <motion.div
              onClick={openEnvelope}
              whileHover={{ scale: 1.1 }}
              className="cursor-pointer text-8xl"
            >
              ğŸ§§
            </motion.div>
          ) : (
            <motion.div
              initial={{ scale: 0 }}
              animate={{ scale: 1 }}
              className="text-6xl"
            >
              ğŸâœ¨
            </motion.div>
          )}

          <p className="text-center">
            Click the red envelope to reveal your New Year blessing!
          </p>
        </CardContent>
      </Card>

      {/* Blessings Display */}
      <div className="mt-8 w-full max-w-md space-y-4">
        {blessings.map((msg, index) => (
          <motion.div
            key={index}
            initial={{ opacity: 0, scale: 0.8 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: 0.5 }}
          >
            <Card className="bg-yellow-400 text-red-800 rounded-2xl shadow-lg">
              <CardContent className="p-4 text-center font-semibold">
                {msg}
              </CardContent>
            </Card>
          </motion.div>
        ))}
      </div>

      {/* Fireworks */}
      <motion.div
        className="absolute inset-0 pointer-events-none"
        animate={{ opacity: [0, 1, 0] }}
        transition={{ repeat: Infinity, duration: 3 }}
      >
        <div className="text-center text-6xl mt-20">ğŸ† ğŸ‡ ğŸ†</div>
      </motion.div>

      <motion.div
        className="absolute bottom-4 text-sm opacity-80"
        animate={{ opacity: [0.5, 1, 0.5] }}
        transition={{ repeat: Infinity, duration: 2 }}
      >
        Gong Xi Fa Cai! æ­å–œå‘è´¢
      </motion.div>
    </div>
  );
}
